<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>For You &#x1F496;</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== CSS Variables ===== */
        :root {
            --bg-default: #FFF5F5;
            --bg-ugly: #8B008B;
            --bg-pretty: #FFB6C1;
            --text-primary: #333;
            --text-light: #fff;
            --pink-accent: #FF69B4;
            --pink-deep: #FF1493;
            --whatsapp-green: #075E54;
            --whatsapp-bg: #ECE5DD;
            --whatsapp-sent: #DCF8C6;
            --whatsapp-received: #FFFFFF;
            --shadow-soft: 0 2px 15px rgba(0,0,0,0.1);
            --font-display: 'Dancing Script', cursive;
            --font-body: 'Quicksand', sans-serif;
        }

        /* ===== Reset & Base ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            height: 100%;
            overflow: hidden;
            font-family: var(--font-body);
            background: var(--bg-default);
            color: var(--text-primary);
            -webkit-tap-highlight-color: transparent;
        }

        /* ===== Page System ===== */
        .page {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.6s ease-in-out, visibility 0.6s ease-in-out, background-color 1.5s ease;
            z-index: 0;
            padding: 20px;
            background-color: var(--bg-default);
        }
        .page.active {
            opacity: 1;
            visibility: visible;
            z-index: 1;
        }
        .page-content {
            text-align: center;
            max-width: 420px;
            width: 100%;
            position: relative;
            z-index: 2;
        }

        /* ===== Typography ===== */
        .romantic-text {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.4;
            margin-bottom: 24px;
        }
        .subtext {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 20px;
            opacity: 0.85;
        }

        /* ===== Buttons ===== */
        .btn {
            padding: 14px 36px;
            border: none;
            border-radius: 50px;
            font-family: var(--font-body);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 8px;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .btn-yes {
            background: var(--pink-accent);
            color: #fff;
            box-shadow: 0 4px 15px rgba(255,105,180,0.4);
        }
        .btn-yes:hover { transform: scale(1.05); }
        .btn-yes:active { transform: scale(0.98); }
        .btn-no {
            background: #e0e0e0;
            color: #666;
        }
        .btn-continue {
            background: var(--pink-accent);
            color: #fff;
            box-shadow: 0 4px 15px rgba(255,105,180,0.4);
        }
        .btn-continue:hover { transform: scale(1.05); }

        /* ===== Fade In Utility ===== */
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== PAGE 1: WhatsApp Chat ===== */
        .chat-container {
            width: 100%;
            max-width: 400px;
            height: 85vh;
            max-height: 650px;
            background: var(--whatsapp-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            background: var(--whatsapp-green);
            color: #fff;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }
        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #128C7E;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }
        .chat-info { flex: 1; }
        .chat-name {
            font-weight: 600;
            font-size: 1rem;
        }
        .chat-status {
            font-size: 0.75rem;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .chat-status::before {
            content: '';
            width: 7px;
            height: 7px;
            background: #25D366;
            border-radius: 50%;
            display: inline-block;
        }
        .chat-body {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 6px;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5 L35 15 L30 12 L25 15 Z' fill='%23d4ccb8' opacity='0.15'/%3E%3C/svg%3E") repeat;
        }
        .message {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.4;
            position: relative;
            animation: msgPop 0.3s ease forwards;
        }
        @keyframes msgPop {
            from { opacity: 0; transform: scale(0.85); }
            to { opacity: 1; transform: scale(1); }
        }
        .message.sent {
            background: var(--whatsapp-sent);
            align-self: flex-end;
            border-top-right-radius: 2px;
        }
        .message.received {
            background: var(--whatsapp-received);
            align-self: flex-start;
            border-top-left-radius: 2px;
        }
        .msg-time {
            display: block;
            font-size: 0.65rem;
            opacity: 0.55;
            text-align: right;
            margin-top: 4px;
        }

        /* Typing indicator */
        .typing-indicator {
            background: var(--whatsapp-received);
            padding: 10px 16px;
            border-radius: 8px;
            align-self: flex-start;
            border-top-left-radius: 2px;
            display: flex;
            gap: 4px;
            align-items: center;
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.15s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.3s; }
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-6px); }
        }

        /* Response option */
        .chat-input-area {
            padding: 12px 16px;
            background: #f0f0f0;
            display: none;
            justify-content: center;
            flex-shrink: 0;
        }
        .response-option {
            background: var(--pink-accent);
            color: #fff;
            padding: 12px 24px;
            border-radius: 50px;
            font-family: var(--font-body);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            animation: pulse 2s infinite;
            touch-action: manipulation;
            text-align: center;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255,105,180,0.5); }
            50% { box-shadow: 0 0 0 10px rgba(255,105,180,0); }
        }

        /* ===== PAGE 2: Ask Permission ===== */
        .button-area {
            position: relative;
            min-height: 120px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        #askNo {
            transition: background 0.5s ease, color 0.5s ease, box-shadow 0.5s ease;
            display: inline-flex;
            gap: 0;
        }
        #askNo .letter {
            display: inline-block;
            transition: transform 0.4s ease, opacity 0.4s ease, filter 0.4s ease;
        }
        #askNo.melting {
            animation: meltDown 0.8s ease forwards;
            pointer-events: none;
        }
        #askNo.respawning {
            animation: respawn 0.5s ease forwards;
            pointer-events: none;
        }
        #askNo.tilted-1 { transform: rotate(3deg); }
        #askNo.tilted-2 { transform: rotate(-5deg); animation: wobble 0.5s ease infinite; }
        #askNo.morphed {
            background: var(--pink-accent);
            color: #fff;
            box-shadow: 0 4px 15px rgba(255,105,180,0.4);
            transform: rotate(0deg);
            animation: none;
        }
        @keyframes meltDown {
            0% { transform: scaleY(1) translateY(0) rotate(0deg); opacity: 1; }
            40% { transform: scaleY(0.6) translateY(10px) rotate(2deg); opacity: 0.8; }
            70% { transform: scaleY(0.2) translateY(40px) rotate(5deg); opacity: 0.4; }
            100% { transform: scaleY(0.05) translateY(60px) rotate(8deg); opacity: 0; }
        }
        @keyframes respawn {
            0% { transform: scaleY(0.05) translateY(60px); opacity: 0; }
            60% { transform: scaleY(1.1) translateY(-5px); opacity: 1; }
            100% { transform: scaleY(1) translateY(0); opacity: 1; }
        }
        @keyframes wobble {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        .morph-msg {
            font-size: 0.95rem;
            font-weight: 500;
            margin-top: 12px;
            opacity: 0;
            transition: opacity 0.5s ease;
            color: var(--pink-deep);
        }
        .morph-msg.visible { opacity: 1; }
        .yes-glow {
            animation: yesGlow 2s infinite;
        }
        @keyframes yesGlow {
            0%, 100% { box-shadow: 0 4px 15px rgba(255,105,180,0.4); }
            50% { box-shadow: 0 4px 25px rgba(255,105,180,0.7); }
        }

        /* ===== PAGE 3: Color Change ===== */
        #page3.bg-ugly {
            background-color: var(--bg-ugly);
            color: var(--text-light);
        }
        #page3.bg-ugly .btn-continue {
            background: #fff;
            color: var(--bg-ugly);
        }
        #page3.bg-pretty {
            background-color: var(--bg-pretty);
            color: var(--text-primary);
        }
        .color-text {
            font-size: 1.3rem;
            font-weight: 600;
            line-height: 1.6;
            transition: opacity 0.4s ease;
        }

        /* ===== PAGE 4: Valentine Question ===== */
        .valentine-question {
            animation: gentlePulse 2s infinite;
        }
        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        #valYes {
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #valNo {
            transition: transform 0.3s ease;
        }
        .floating-hearts {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        .floating-heart {
            position: absolute;
            opacity: 0;
            animation: floatUp var(--duration) var(--delay) infinite;
            pointer-events: none;
        }
        @keyframes floatUp {
            0% { opacity: 0; transform: translateY(100vh) scale(0.5) rotate(0deg); }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { opacity: 0; transform: translateY(-20vh) scale(1.2) rotate(45deg); }
        }

        /* ===== PAGE 5: Celebration ===== */
        .confetti-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        .confetti-piece {
            position: absolute;
            top: -20px;
            width: var(--size);
            height: calc(var(--size) * 0.6);
            background: var(--color);
            border-radius: 2px;
            opacity: 0;
            animation: confettiFall var(--fall-duration) var(--delay) linear forwards;
            will-change: transform;
        }
        .confetti-piece.heart-shape {
            background: none;
            width: auto;
            height: auto;
            font-size: var(--size);
            line-height: 1;
        }
        @keyframes confettiFall {
            0% { top: -20px; opacity: 1; transform: translateX(0) rotateZ(0deg); }
            25% { transform: translateX(var(--sway)) rotateZ(180deg); }
            50% { transform: translateX(calc(var(--sway) * -0.5)) rotateZ(360deg); }
            75% { transform: translateX(var(--sway)) rotateZ(540deg); }
            100% { top: 110vh; opacity: 0.3; transform: translateX(0) rotateZ(720deg); }
        }
        .celebration { position: relative; z-index: 2; }
        .celebration-text {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 700;
            animation: bounceIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            margin-bottom: 16px;
        }
        @keyframes bounceIn {
            from { opacity: 0; transform: scale(0.3); }
            to { opacity: 1; transform: scale(1); }
        }
        .celebration-message {
            font-size: 1.2rem;
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 30px;
            animation: fadeIn 0.8s 0.5s ease both;
        }

        /* ===== PAGE 6: Card Game ===== */
        .card-instruction {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 24px;
            opacity: 0.8;
        }
        .cards-container {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 24px 0;
        }
        .flip-card {
            width: 110px;
            height: 160px;
            perspective: 800px;
            cursor: pointer;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .flip-card:hover { transform: translateY(-4px); }
        .flip-card-inner {
            position: relative;
            width: 100%; height: 100%;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%; height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .flip-card-front {
            background: linear-gradient(135deg, var(--pink-accent), var(--pink-deep));
            color: #fff;
            box-shadow: 0 4px 15px rgba(255,20,147,0.3);
        }
        .card-number {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            opacity: 0.9;
        }
        .card-decoration {
            font-size: 1.5rem;
            margin-top: 8px;
        }
        .flip-card-back {
            background: #fff;
            color: var(--text-primary);
            transform: rotateY(180deg);
            box-shadow: var(--shadow-soft);
            padding: 15px;
            text-align: center;
        }
        .card-reveal {
            font-family: var(--font-display);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--pink-deep);
            line-height: 1.4;
        }
        .confirm-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 16px;
        }
        .shake {
            animation: shake 0.5s ease;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }
        .final-section {
            margin-top: 30px;
        }
        .final-section .romantic-text {
            color: var(--pink-deep);
        }
        .final-subtext {
            font-size: 1.1rem;
            font-weight: 500;
            margin-top: 10px;
            opacity: 0.85;
        }

        /* ===== Responsive ===== */
        @media (max-width: 380px) {
            .flip-card { width: 90px; height: 130px; }
            .romantic-text { font-size: 1.5rem; }
            .btn { padding: 12px 28px; font-size: 1rem; }
            .celebration-text { font-size: 2.2rem; }
            .chat-container { height: 80vh; }
            .card-number { font-size: 1.5rem; }
            .card-reveal { font-size: 1rem; }
        }
        @media (min-width: 768px) {
            .romantic-text { font-size: 2.5rem; }
            .flip-card { width: 140px; height: 200px; }
            .card-number { font-size: 2.5rem; }
            .card-reveal { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

    <!-- ===== PAGE 1: WhatsApp Chat ===== -->
    <div class="page active" id="page1">
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-avatar">N</div>
                <div class="chat-info">
                    <div class="chat-name">Nikhil</div>
                    <div class="chat-status">online</div>
                </div>
            </div>
            <div class="chat-body" id="chatBody"></div>
            <div class="chat-input-area" id="chatInputArea">
                <div class="response-option" id="responseBtn">Hi Nikhil, I m good.</div>
            </div>
        </div>
    </div>

    <!-- ===== PAGE 2: Can I Ask You Something? ===== -->
    <div class="page" id="page2">
        <div class="page-content">
            <h1 class="romantic-text">Can I ask you something? &#x1F914;</h1>
            <div class="button-area" id="askBtnContainer">
                <button class="btn btn-yes yes-glow" id="askYes">Yes</button>
                <button class="btn btn-no" id="askNo"><span class="letter">N</span><span class="letter">o</span></button>
            </div>
            <p class="morph-msg" id="morphMsg">Even the button agrees &#x1F604;</p>
        </div>
    </div>

    <!-- ===== PAGE 3: Background Color Change ===== -->
    <div class="page" id="page3">
        <div class="page-content">
            <p class="color-text" id="page3Text">Actually, let me change the background to your favorite color...</p>
            <button class="btn btn-continue" id="page3Continue" style="display: none;">There you go!</button>
        </div>
    </div>

    <!-- ===== PAGE 4: Will You Be My Valentine? ===== -->
    <div class="page" id="page4">
        <div class="floating-hearts" id="floatingHearts"></div>
        <div class="page-content">
            <h1 class="romantic-text valentine-question">Will you be my Valentine? &#x1F49D;</h1>
            <div>
                <button class="btn btn-yes" id="valYes">Yes!</button>
                <button class="btn btn-no" id="valNo">No</button>
            </div>
        </div>
    </div>

    <!-- ===== PAGE 5: Celebration ===== -->
    <div class="page" id="page5">
        <div class="confetti-container" id="confettiContainer"></div>
        <div class="page-content celebration">
            <div class="celebration-text">Yay! &#x1F389;</div>
            <p class="celebration-message">
                I'm so happy you said yes! &#x1F495;<br>
                You just made my day so much better.
            </p>
            <button class="btn btn-continue" id="page5Continue">There's one more thing...</button>
        </div>
    </div>

    <!-- ===== PAGE 6: Card Game ===== -->
    <div class="page" id="page6">
        <div class="page-content">
            <h2 class="romantic-text">What do you want to do this weekend? &#x1F914;</h2>
            <p class="card-instruction" id="cardInstruction">Pick a card, any card!</p>
            <div class="cards-container" id="cardsContainer">
                <div class="flip-card" data-card="1">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="card-number">1</span>
                            <span class="card-decoration">&#x2665;</span>
                        </div>
                        <div class="flip-card-back">
                            <span class="card-reveal">Online Watch Party &#x1F3AC;</span>
                        </div>
                    </div>
                </div>
                <div class="flip-card" data-card="2">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="card-number">2</span>
                            <span class="card-decoration">&#x2665;</span>
                        </div>
                        <div class="flip-card-back">
                            <span class="card-reveal">Online Watch Party &#x1F3AC;</span>
                        </div>
                    </div>
                </div>
                <div class="flip-card" data-card="3">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <span class="card-number">3</span>
                            <span class="card-decoration">&#x2665;</span>
                        </div>
                        <div class="flip-card-back">
                            <span class="card-reveal">Online Watch Party &#x1F3AC;</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="confirmFlow" style="display: none;">
                <p class="confirm-text" id="confirmText"></p>
                <div>
                    <button class="btn btn-yes" id="confirmYes">Yes!</button>
                    <button class="btn btn-no" id="confirmChange">Let me change</button>
                </div>
            </div>
            <div class="final-section" id="finalMessage" style="display: none;">
                <h2 class="romantic-text">You'll get an invite soon! &#x1F48C;</h2>
                <p class="final-subtext">Can't wait! &#x1F60A;</p>
            </div>
        </div>
    </div>

    <script>
    (function() {
        /* ===== Page Navigation ===== */
        const pages = document.querySelectorAll('.page');
        let currentPage = 0;

        function goToPage(index) {
            pages[currentPage].classList.remove('active');
            currentPage = index;
            pages[currentPage].classList.add('active');
            if (pageInits[currentPage]) pageInits[currentPage]();
        }

        const pageInits = {
            0: initPage1,
            1: initPage2,
            2: initPage3,
            3: initPage4,
            4: initPage5,
            5: initPage6
        };

        /* Track which pages have been initialized */
        const initialized = {};

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function createTypingIndicator() {
            const div = document.createElement('div');
            div.className = 'typing-indicator';
            div.innerHTML = '<span></span><span></span><span></span>';
            return div;
        }

        /* ===== PAGE 1: WhatsApp Chat ===== */
        function initPage1() {
            if (initialized[0]) return;
            initialized[0] = true;

            const chatBody = document.getElementById('chatBody');
            const chatInput = document.getElementById('chatInputArea');
            const responseBtn = document.getElementById('responseBtn');

            const messages = [
                { text: 'Hey Hymavathi, this is Nikhil!', type: 'sent', typingDelay: 1200 },
                { text: 'how are you?', type: 'sent', typingDelay: 1500 }
            ];

            let msgIndex = 0;

            function showNextMessage() {
                if (msgIndex >= messages.length) {
                    setTimeout(function() {
                        chatInput.style.display = 'flex';
                        chatInput.classList.add('fade-in');
                    }, 800);
                    return;
                }

                var msg = messages[msgIndex];
                var typing = createTypingIndicator();
                chatBody.appendChild(typing);
                chatBody.scrollTop = chatBody.scrollHeight;

                setTimeout(function() {
                    typing.remove();
                    var bubble = document.createElement('div');
                    bubble.className = 'message ' + msg.type;
                    bubble.innerHTML = '<span class="msg-text">' + msg.text + '</span><span class="msg-time">' + getCurrentTime() + '</span>';
                    chatBody.appendChild(bubble);
                    chatBody.scrollTop = chatBody.scrollHeight;
                    msgIndex++;
                    showNextMessage();
                }, msg.typingDelay);
            }

            setTimeout(showNextMessage, 600);

            responseBtn.addEventListener('click', function() {
                chatInput.style.display = 'none';
                var bubble = document.createElement('div');
                bubble.className = 'message received';
                bubble.innerHTML = '<span class="msg-text">Hi Nikhil, I m good.</span><span class="msg-time">' + getCurrentTime() + '</span>';
                chatBody.appendChild(bubble);
                chatBody.scrollTop = chatBody.scrollHeight;
                setTimeout(function() { goToPage(1); }, 1500);
            });
        }

        /* ===== PAGE 2: Melting No Button ===== */
        function initPage2() {
            if (initialized[1]) return;
            initialized[1] = true;

            var noBtn = document.getElementById('askNo');
            var yesBtn = document.getElementById('askYes');
            var morphMsg = document.getElementById('morphMsg');
            var meltCount = 0;
            var isMelting = false;
            var isMorphed = false;
            var morphComplete = false;

            var respawnTexts = ['No', 'Ouch...', 'Stop it...'];

            function handleNoClick(e) {
                e.preventDefault();
                if (isMelting || isMorphed) return;

                meltCount++;

                if (meltCount <= 3) {
                    /* Melt the button */
                    isMelting = true;
                    noBtn.classList.remove('respawning', 'tilted-1', 'tilted-2');
                    noBtn.classList.add('melting');

                    setTimeout(function() {
                        /* Respawn after melt */
                        noBtn.classList.remove('melting');

                        /* Update text for respawn */
                        var letters = noBtn.querySelectorAll('.letter');
                        var newText = respawnTexts[meltCount - 1] || 'No';
                        /* Replace letter spans with new text spans */
                        noBtn.innerHTML = '';
                        for (var i = 0; i < newText.length; i++) {
                            var span = document.createElement('span');
                            span.className = 'letter';
                            span.textContent = newText[i];
                            noBtn.appendChild(span);
                        }

                        /* Add tilt classes for progressive damage */
                        if (meltCount === 2) noBtn.classList.add('tilted-1');
                        if (meltCount === 3) noBtn.classList.add('tilted-2');

                        noBtn.classList.add('respawning');
                        setTimeout(function() {
                            noBtn.classList.remove('respawning');
                            isMelting = false;
                        }, 500);
                    }, 900);
                } else {
                    /* Attempt 4: Morph "No" into "Yes" letter by letter */
                    isMorphed = true;

                    /* Reset to "No" first for the morph */
                    noBtn.innerHTML = '';
                    noBtn.classList.remove('tilted-1', 'tilted-2');
                    noBtn.style.animation = 'none';

                    var noSpan = document.createElement('span');
                    noSpan.className = 'letter';
                    noSpan.textContent = 'N';
                    noBtn.appendChild(noSpan);

                    var oSpan = document.createElement('span');
                    oSpan.className = 'letter';
                    oSpan.textContent = 'o';
                    noBtn.appendChild(oSpan);

                    /* Step 1: blur and morph N → Y */
                    setTimeout(function() {
                        noSpan.style.filter = 'blur(3px)';
                        noSpan.style.transform = 'scale(0.8)';
                        setTimeout(function() {
                            noSpan.textContent = 'Y';
                            noSpan.style.filter = 'blur(0)';
                            noSpan.style.transform = 'scale(1)';

                            /* Step 2: blur and morph o → e */
                            setTimeout(function() {
                                oSpan.style.filter = 'blur(3px)';
                                oSpan.style.transform = 'scale(0.8)';
                                setTimeout(function() {
                                    oSpan.textContent = 'e';
                                    oSpan.style.filter = 'blur(0)';
                                    oSpan.style.transform = 'scale(1)';

                                    /* Step 3: fade in "s" */
                                    setTimeout(function() {
                                        var sSpan = document.createElement('span');
                                        sSpan.className = 'letter';
                                        sSpan.textContent = 's';
                                        sSpan.style.opacity = '0';
                                        sSpan.style.transform = 'scale(0.5)';
                                        noBtn.appendChild(sSpan);
                                        /* Trigger transition */
                                        requestAnimationFrame(function() {
                                            sSpan.style.opacity = '1';
                                            sSpan.style.transform = 'scale(1)';
                                        });

                                        /* Restyle as Yes button */
                                        noBtn.classList.add('morphed');

                                        /* Show the message and enable navigation */
                                        setTimeout(function() {
                                            morphMsg.classList.add('visible');
                                            morphComplete = true;
                                        }, 400);
                                    }, 300);
                                }, 300);
                            }, 400);
                        }, 300);
                    }, 200);
                }
            }

            noBtn.addEventListener('click', handleNoClick);
            noBtn.addEventListener('touchstart', handleNoClick, { passive: false });

            yesBtn.addEventListener('click', function() {
                goToPage(2);
            });

            /* After morph completes, make the morphed No button also work as Yes */
            noBtn.addEventListener('click', function() {
                if (morphComplete) goToPage(2);
            });
        }

        /* ===== PAGE 3: Background Color Change ===== */
        function initPage3() {
            if (initialized[2]) return;
            initialized[2] = true;

            var page = document.getElementById('page3');
            var text = document.getElementById('page3Text');
            var btn = document.getElementById('page3Continue');
            var phase = 0;

            setTimeout(function() {
                page.classList.add('bg-ugly');
                text.textContent = ' ';
                btn.style.display = 'inline-block';
                btn.classList.add('fade-in');
                phase = 1;
            }, 2000);

            btn.addEventListener('click', function() {
                if (phase === 1) {
                    page.classList.remove('bg-ugly');
                    page.classList.add('bg-pretty');
                    text.textContent = 'Just kidding, this is much better \uD83D\uDC95';
                    btn.textContent = 'Continue \u2192';
                    phase = 2;
                } else if (phase === 2) {
                    goToPage(3);
                }
            });
        }

        /* ===== PAGE 4: Valentine Question ===== */
        function initPage4() {
            if (initialized[3]) return;
            initialized[3] = true;

            var yesBtn = document.getElementById('valYes');
            var noBtn = document.getElementById('valNo');
            var yesScale = 1;
            var noAttempts = 0;

            var noPhrases = [
                'No',
                'Are you sure?',
                'Really sure? \uD83E\uDD28',
                'Think again!',
                'Please? \uD83E\uDD7A',
                'Pretty please? \uD83D\uDE4F',
                'Last chance!',
                'Okay fine... just click Yes \uD83D\uDC95'
            ];

            function handleNoAttempt(e) {
                e.preventDefault();
                noAttempts++;
                yesScale += 0.25;
                yesBtn.style.transform = 'scale(' + yesScale + ')';

                if (noAttempts < noPhrases.length) {
                    noBtn.textContent = noPhrases[noAttempts];
                } else {
                    noBtn.textContent = noPhrases[noPhrases.length - 1];
                }

                if (noAttempts >= 4) {
                    var noScale = Math.max(0.5, 1 - (noAttempts - 3) * 0.1);
                    noBtn.style.transform = 'scale(' + noScale + ')';
                }
            }

            noBtn.addEventListener('click', handleNoAttempt);
            noBtn.addEventListener('mouseenter', handleNoAttempt);
            noBtn.addEventListener('touchstart', handleNoAttempt, { passive: false });

            yesBtn.addEventListener('click', function() {
                goToPage(4);
            });

            /* Floating hearts */
            var heartsContainer = document.getElementById('floatingHearts');
            var hearts = ['\uD83D\uDC95', '\uD83D\uDC96', '\uD83D\uDC97', '\uD83D\uDC9D', '\u2764\uFE0F', '\uD83D\uDC98'];
            for (var i = 0; i < 15; i++) {
                var heart = document.createElement('span');
                heart.className = 'floating-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.setProperty('--duration', (4 + Math.random() * 4) + 's');
                heart.style.setProperty('--delay', (Math.random() * 5) + 's');
                heart.style.fontSize = (0.8 + Math.random() * 1.2) + 'rem';
                heartsContainer.appendChild(heart);
            }
        }

        /* ===== PAGE 5: Celebration ===== */
        function initPage5() {
            if (initialized[4]) return;
            initialized[4] = true;

            var container = document.getElementById('confettiContainer');
            var colors = ['#FF69B4', '#FF1493', '#FFB6C1', '#FF6B6B', '#FFD700', '#FFA07A', '#FF4500'];
            var heartEmojis = ['\u2764\uFE0F', '\uD83D\uDC96', '\uD83D\uDC95'];

            for (var i = 0; i < 50; i++) {
                var piece = document.createElement('div');
                var isHeart = Math.random() > 0.6;

                if (isHeart) {
                    piece.className = 'confetti-piece heart-shape';
                    piece.textContent = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];
                    piece.style.setProperty('--size', (0.6 + Math.random() * 0.8) + 'rem');
                } else {
                    piece.className = 'confetti-piece';
                    piece.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
                    piece.style.setProperty('--size', (6 + Math.random() * 6) + 'px');
                }

                piece.style.left = Math.random() * 100 + '%';
                piece.style.setProperty('--fall-duration', (2 + Math.random() * 3) + 's');
                piece.style.setProperty('--delay', Math.random() * 3 + 's');
                piece.style.setProperty('--sway', (-30 + Math.random() * 60) + 'px');
                container.appendChild(piece);
            }

            document.getElementById('page5Continue').addEventListener('click', function() {
                goToPage(5);
            });
        }

        /* ===== PAGE 6: Card Game ===== */
        function initPage6() {
            if (initialized[5]) return;
            initialized[5] = true;

            var cards = document.querySelectorAll('.flip-card');
            var confirmFlow = document.getElementById('confirmFlow');
            var confirmText = document.getElementById('confirmText');
            var confirmYes = document.getElementById('confirmYes');
            var confirmChange = document.getElementById('confirmChange');
            var finalMessage = document.getElementById('finalMessage');
            var cardInstruction = document.getElementById('cardInstruction');
            var selectedCard = null;
            var confirmStep = 0;

            var confirmPrompts = [
                'Are you sure? \uD83E\uDD14',
                'Really sure? \uD83D\uDE0F',
                'Last chance to change your mind! \uD83E\uDEE3'
            ];

            cards.forEach(function(card) {
                card.addEventListener('click', function() {
                    if (selectedCard) return;
                    selectedCard = this;

                    this.style.transform = 'scale(1.08)';
                    this.style.boxShadow = '0 0 25px rgba(255,105,180,0.5)';

                    cards.forEach(function(c) {
                        if (c !== selectedCard) {
                            c.style.opacity = '0.35';
                            c.style.pointerEvents = 'none';
                        }
                    });

                    cardInstruction.style.display = 'none';
                    confirmStep = 0;
                    confirmText.textContent = confirmPrompts[confirmStep];
                    confirmFlow.style.display = 'block';
                    confirmFlow.classList.add('fade-in');
                });
            });

            confirmYes.addEventListener('click', function() {
                confirmStep++;
                if (confirmStep < confirmPrompts.length) {
                    confirmText.textContent = confirmPrompts[confirmStep];
                    confirmText.classList.remove('shake');
                    void confirmText.offsetWidth;
                    confirmText.classList.add('shake');
                } else {
                    confirmFlow.style.display = 'none';
                    selectedCard.classList.add('flipped');
                    selectedCard.style.transform = 'scale(1.08)';

                    setTimeout(function() {
                        finalMessage.style.display = 'block';
                        finalMessage.classList.add('fade-in');
                    }, 1000);
                }
            });

            confirmChange.addEventListener('click', function() {
                selectedCard.style.transform = '';
                selectedCard.style.boxShadow = '';
                cards.forEach(function(c) {
                    c.style.opacity = '1';
                    c.style.pointerEvents = 'auto';
                });
                selectedCard = null;
                confirmStep = 0;
                confirmFlow.style.display = 'none';
                cardInstruction.style.display = 'block';
            });
        }

        /* ===== Initialize first page ===== */
        initPage1();
    })();
    </script>
</body>
</html>
